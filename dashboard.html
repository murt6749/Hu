<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HU Jama'aa - Courses</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    :root {
      --primary-color: #1a4d2e;
      --secondary-color: #4f6f52;
      --accent-color: #f5efe6;
      --light-color: #e8dfca;
      --white: #ffffff;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --success-color: #28a745;
      --info-color: #17a2b8;
      --warning-color: #ffc107;
      --danger-color: #dc3545;
      --border-radius: 12px;
      --box-padding: 16px;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }
    body {
      background-color: #f8f9fa;
      min-height: 100vh;
      font-size: 14px;
    }
    .container {
      width: 100%;
      max-width: 100%;
      padding: 0;
    }
    /* Header Styles */
    .header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: var(--box-padding);
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .header h1 {
      font-size: 1.2rem;
      font-weight: 600;
    }
    .header-actions {
      display: flex;
      gap: 10px;
    }
    .btn-icon {
      background: none;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
    }
    /* Main Content Area */
    .main-content {
      padding: var(--box-padding);
      padding-bottom: 70px; /* Space for bottom nav */
    }
    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: var(--white);
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      z-index: 100;
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: var(--secondary-color);
      font-size: 0.8rem;
    }
    .nav-item i {
      font-size: 1.2rem;
      margin-bottom: 4px;
    }
    .nav-item.active {
      color: var(--primary-color);
    }
    /* Card Styles */
    .card {
      background-color: var(--white);
      border-radius: var(--border-radius);
      padding: var(--box-padding);
      margin-bottom: 15px;
      box-shadow: var(--shadow);
    }
    .card-title {
      color: var(--primary-color);
      margin-bottom: 10px;
      font-size: 1.1rem;
      font-weight: 600;
    }
    /* Course Card Custom (only title and language) */
    .course-card {
      background-color: var(--white);
      border: 1px solid #eee;
      border-radius: var(--border-radius);
      margin-bottom: 15px;
      padding: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow);
    }
    .course-info {
      display: flex;
      flex-direction: column;
    }
    .course-title {
      font-size: 1rem;
      font-weight: 600;
    }
    .course-language {
      margin-top: 4px;
      display: inline-block;
      padding: 4px 8px;
      border-radius: 20px;
      background-color: var(--info-color);
      color: var(--white);
      font-size: 0.8rem;
      font-weight: 500;
      width: max-content;
    }
    .enroll-btn {
      background-color: var(--primary-color);
      border: none;
      color: var(--white);
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }
    /* Filter Container */
    .filter-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 15px;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      background-color: var(--white);
      border-radius: var(--border-radius);
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      animation: modalFadeIn 0.3s ease;
    }
    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .modal-header {
      padding: 15px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-title {
      font-size: 1.2rem;
      color: var(--primary-color);
      font-weight: 600;
    }
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
    }
    .modal-body {
      padding: 15px;
    }
    .modal-footer {
      padding: 15px;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    /* Form Elements */
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--secondary-color);
    }
    .form-control {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
    }
    .btn {
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }
    .btn-primary {
      background-color: var(--primary-color);
      color: var(--white);
    }
    .btn-primary:hover {
      background-color: var(--secondary-color);
    }
    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--primary-color);
      color: var(--primary-color);
    }
    .btn-sm {
      padding: 8px 12px;
      font-size: 0.9rem;
    }
    .d-none {
      display: none;
    }
    @media (min-width: 768px) {
      .container {
        max-width: 768px;
        margin: 0 auto;
      }
      .filter-container {
        grid-template-columns: repeat(4, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1 id="page-title">My Courses</h1>
      <div class="header-actions">
        <button class="btn-icon" id="notifications-btn">
          <i class="fas fa-bell"></i>
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content" id="main-content">
      <!-- Dynamic content loaded here -->
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
      <a href="#" class="nav-item active" data-page="courses">
        <i class="fas fa-book"></i>
        <span>Courses</span>
      </a>
      <a href="#" class="nav-item" data-page="progress">
        <i class="fas fa-chart-line"></i>
        <span>Progress</span>
      </a>
      <a href="#" class="nav-item" data-page="classmates">
        <i class="fas fa-users"></i>
        <span>Classmates</span>
      </a>
      <a href="#" class="nav-item" data-page="profile">
        <i class="fas fa-user"></i>
        <span>Profile</span>
      </a>
    </nav>
  </div>

  <!-- Confirmation Modal (for enrollment) -->
  <div class="modal" id="confirmation-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="confirmation-title">Confirm Enrollment</h3>
        <button class="modal-close" id="close-confirmation-modal">&times;</button>
      </div>
      <div class="modal-body">
        <h4 id="confirmation-message">Are you sure you want to enroll?</h4>
        <!-- This extra input appears only when enrolling the fourth course -->
        <div class="form-group d-none" id="verification-group">
          <label for="verification-input">Verification:</label>
          <input type="text" id="verification-input" class="form-control" placeholder="Enter verification text" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" id="cancel-confirm">Cancel</button>
        <button class="btn btn-primary" id="confirm-action">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Firebase SDK and Application Code -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import {
      getFirestore,
      collection,
      doc,
      getDoc,
      getDocs,
      setDoc,
      updateDoc,
      arrayUnion,
      arrayRemove,
      query,
      where,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBQyNVWh1BtCkXlBfuS7jHAa36FTklZayo",
      authDomain: "pharma-quiz-b5a07.firebaseapp.com",
      projectId: "pharma-quiz-b5a07",
      storageBucket: "pharma-quiz-b5a07.appspot.com",
      messagingSenderId: "161067776789",
      appId: "1:161067776789:web:88b8a61145dc5f5c31471c",
      measurementId: "G-3QRQE9HQFB"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM Elements
    const mainContent = document.getElementById('main-content');
    const pageTitle = document.getElementById('page-title');
    const bottomNavItems = document.querySelectorAll('.bottom-nav .nav-item');
    const confirmationModal = document.getElementById('confirmation-modal');
    const confirmationTitle = document.getElementById('confirmation-title');
    const confirmationMessage = document.getElementById('confirmation-message');
    const cancelConfirmBtn = document.getElementById('cancel-confirm');
    const confirmActionBtn = document.getElementById('confirm-action');
    const verificationGroup = document.getElementById('verification-group');
    const verificationInput = document.getElementById('verification-input');

    let currentUser = null;
    let userData = null;
    let enrolledCourses = [];
    let allCourses = [];
    let classmatesData = [];
    let pendingAction = null; // { type: 'enroll', courseId: string, requireVerification: boolean }

    // Complete course data (all courses are included)
    const completeCoursesData = [
      {
        id: "q1",
        title: "Sifetu Solah (Amharic)",
        type: "qirat",
        language: "Amharic"
      },
      {
        id: "q2",
        title: "Usulu Selasah (Amharic)",
        type: "qirat",
        language: "Amharic"
      },
      {
        id: "q3",
        title: "Tejwid Hidayetul Mustefid (Amharic)",
        type: "qirat",
        language: "Amharic"
      },
      {
        id: "q4",
        title: "Kula Setun Urely Eqin (Amharic)",
        type: "qirat",
        language: "Amharic"
      },
      {
        id: "q5",
        title: "Sifetu Solah (Oromifa)",
        type: "qirat",
        language: "Oromifa"
      },
      {
        id: "q6",
        title: "Usulu Selasah (Oromifa)",
        type: "qirat",
        language: "Oromifa"
      },
      {
        id: "q7",
        title: "Tejwid Hidayetul Mustefid (Oromifa)",
        type: "qirat",
        language: "Oromifa"
      },
      {
        id: "q8",
        title: "Umdetul Ahkam (Oromifa)",
        type: "qirat",
        language: "Oromifa"
      },
      {
        id: "q9",
        title: "Riyadus Ualihin (Oromifa)",
        type: "qirat",
        language: "Oromifa"
      },
      {
        id: "q10",
        title: "Tefsir (Oromifa)",
        type: "qirat",
        language: "Oromifa"
      },
      {
        id: "q11",
        title: "Aqidetu Tahawiya (Oromifa)",
        type: "qirat",
        language: "Oromifa"
      },
      {
        id: "h1",
        title: "Hifz for Fresh Students (Female)",
        type: "hifz",
        language: "Amharic"
      },
      {
        id: "h2",
        title: "Hifz for Fresh Students (Female)",
        type: "hifz",
        language: "Amharic"
      },
      {
        id: "h3",
        title: "Hifz for Fresh Students (Female)",
        type: "hifz",
        language: "Amharic"
      },
      {
        id: "h4",
        title: "Hifz for Fresh Students (Male)",
        type: "hifz",
        language: "Amharic"
      },
      {
        id: "h5",
        title: "Hifz for Fresh Students (Male)",
        type: "hifz",
        language: "Amharic"
      },
      {
        id: "h6",
        title: "Hifz for Senior Students (Female)",
        type: "hifz",
        language: "Amharic"
      },
      {
        id: "h7",
        title: "Hifz for Senior Students (Female)",
        type: "hifz",
        language: "Amharic"
      },
      {
        id: "h8",
        title: "Hifz for Senior Students (Female)",
        type: "hifz",
        language: "Amharic"
      },
      {
        id: "h9",
        title: "Hifz for Senior Students (Male)",
        type: "hifz",
        language: "Amharic"
      },
      {
        id: "h10",
        title: "Hifz for Senior Students (Male)",
        type: "hifz",
        language: "Amharic"
      },
      {
        id: "n1",
        title: "Nezer for Fresh Students (Female - Amharic)",
        type: "nezer",
        language: "Amharic"
      },
      {
        id: "n2",
        title: "Nezer for Fresh Students (Female - Oromifa)",
        type: "nezer",
        language: "Oromifa"
      },
      {
        id: "n3",
        title: "Nezer for Fresh Students (Male - Amharic)",
        type: "nezer",
        language: "Amharic"
      },
      {
        id: "n4",
        title: "Nezer for Fresh Students (Male - Oromifa)",
        type: "nezer",
        language: "Oromifa"
      },
      {
        id: "n5",
        title: "Nezer for Fresh Students (Male)",
        type: "nezer",
        language: "Amharic"
      },
      {
        id: "n6",
        title: "Nezer for Senior Students (Female)",
        type: "nezer",
        language: "Amharic"
      },
      {
        id: "n7",
        title: "Nezer for Senior Students (Female)",
        type: "nezer",
        language: "Amharic"
      },
      {
        id: "n8",
        title: "Nezer for Senior Students (Male)",
        type: "nezer",
        language: "Amharic"
      },
      {
        id: "n9",
        title: "Nezer for Senior Students (Male)",
        type: "nezer",
        language: "Amharic"
      },
      {
        id: "n10",
        title: "Nezer for Senior Students (Male)",
        type: "nezer",
        language: "Amharic"
      }
    ];

    // Initialize app and set up navigation and authentication
    function initApp() {
      bottomNavItems.forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();
          const page = item.getAttribute('data-page');
          bottomNavItems.forEach(nav => nav.classList.remove('active'));
          item.classList.add('active');
          if (page === 'progress') {
            window.location.href = 'progress.html';
          } else {
            switchTab(page);
          }
        });
      });
      cancelConfirmBtn.addEventListener('click', () => {
        confirmationModal.classList.remove('active');
        pendingAction = null;
      });
      confirmActionBtn.addEventListener('click', executePendingAction);
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          currentUser = user;
          await loadUserData(user.uid);
          switchTab('courses');
        } else {
          window.location.href = 'login.html';
        }
      });
      allCourses = completeCoursesData;
    }

    async function loadUserData(userId) {
      try {
        const userDoc = await getDoc(doc(db, "users", userId));
        if (userDoc.exists()) {
          userData = userDoc.data();
          if (!userData.enrolledCourses) {
            await updateDoc(doc(db, "users", userId), { enrolledCourses: [] });
            userData.enrolledCourses = [];
          }
          enrolledCourses = userData.enrolledCourses;
        } else {
          const newUserData = {
            name: currentUser.displayName || "User",
            email: currentUser.email,
            enrolledCourses: [],
            studentId: "",
            department: "",
            year: "",
            phone: "",
            createdAt: serverTimestamp()
          };
          await setDoc(doc(db, "users", userId), newUserData);
          userData = newUserData;
          enrolledCourses = [];
        }
      } catch (error) {
        console.error("Error loading user data:", error);
      }
    }

    function switchTab(tabName) {
      pageTitle.textContent = getPageTitle(tabName);
      if (tabName === 'courses') {
        loadCoursesPage();
      } else if (tabName === 'classmates') {
        loadClassmatesPage();
      } else if (tabName === 'profile') {
        loadProfilePage();
      } else {
        loadCoursesPage();
      }
    }

    function getPageTitle(tabName) {
      switch(tabName) {
        case 'courses': return 'My Courses';
        case 'classmates': return 'Classmates';
        case 'profile': return 'My Profile';
        default: return "HU Jama'aa";
      }
    }

    // COURSES PAGE
    function loadCoursesPage() {
      let html = `
        <div class="card">
          <h2 class="card-title">Available Courses</h2>
          <div class="filter-container">
            <div class="form-group">
              <label for="type-filter">Type</label>
              <select id="type-filter" class="form-control">
                <option value="all">All Types</option>
                <option value="qirat">Qirat</option>
                <option value="hifz">Hifz</option>
                <option value="nezer">Nezer</option>
              </select>
            </div>
            <div class="form-group">
              <label for="language-filter">Language</label>
              <select id="language-filter" class="form-control">
                <option value="all">All Languages</option>
                <option value="Amharic">Amharic</option>
                <option value="Oromifa">Oromifa</option>
              </select>
            </div>
          </div>
          <div id="courses-display"></div>
        </div>
        <div class="card">
          <h2 class="card-title">My Enrolled Courses</h2>
          <div id="enrolled-courses"></div>
        </div>
      `;
      mainContent.innerHTML = html;
      document.getElementById('type-filter').addEventListener('change', filterAndDisplayCourses);
      document.getElementById('language-filter').addEventListener('change', filterAndDisplayCourses);
      filterAndDisplayCourses();
      displayEnrolledCourses();
    }

    function filterAndDisplayCourses() {
      const typeFilter = document.getElementById('type-filter').value || 'all';
      const languageFilter = document.getElementById('language-filter').value || 'all';
      let filteredCourses = allCourses;
      if (typeFilter !== 'all') {
        filteredCourses = filteredCourses.filter(course => course.type === typeFilter);
      }
      if (languageFilter !== 'all') {
        filteredCourses = filteredCourses.filter(course => course.language === languageFilter);
      }
      // Show all courses (even if already enrolled) so that none are left out
      displayCoursesAsCards(filteredCourses);
    }

    function displayCoursesAsCards(courses) {
      const coursesDisplay = document.getElementById('courses-display');
      if (!coursesDisplay) return;
      if (courses.length === 0) {
        coursesDisplay.innerHTML = '<p>No courses available matching your filters.</p>';
        return;
      }
      coursesDisplay.innerHTML = '';
      courses.forEach(course => {
        // Create a course card with a flex container:
        const card = document.createElement('div');
        card.className = 'course-card';
        card.innerHTML = `
          <div class="course-info">
            <div class="course-title">${course.title}</div>
            <div class="course-language">${course.language}</div>
          </div>
          <button class="enroll-btn" onclick="showEnrollConfirmation('${course.id}')">
            <i class="fas fa-plus"></i>
          </button>
        `;
        coursesDisplay.appendChild(card);
      });
    }

    // Display enrolled courses (only showing title and language)
    function displayEnrolledCourses() {
      const enrolledContainer = document.getElementById('enrolled-courses');
      if (!enrolledContainer) return;
      if (enrolledCourses.length === 0) {
        enrolledContainer.innerHTML = '<p>You are not enrolled in any courses yet.</p>';
        return;
      }
      enrolledContainer.innerHTML = '';
      enrolledCourses.forEach(course => {
        // Find the full course in allCourses (if needed)
        const fullCourse = allCourses.find(c => c.id === course.id) || course;
        const item = document.createElement('div');
        item.className = 'course-card';
        item.innerHTML = `
          <div class="course-info">
            <div class="course-title">${fullCourse.title}</div>
            <div class="course-language">${fullCourse.language}</div>
          </div>
        `;
        enrolledContainer.appendChild(item);
      });
    }

    // Verification and Enrollment Handling
    function showEnrollConfirmation(courseId) {
      const course = allCourses.find(c => c.id === courseId);
      if (!course) return;
      pendingAction = {
        type: 'enroll',
        courseId: courseId,
        requireVerification: enrolledCourses.length >= 3 // for 4th and subsequent enrollments
      };
      if (pendingAction.requireVerification) {
        confirmationTitle.textContent = 'Verify Enrollment';
        confirmationMessage.textContent = `You are enrolling your 4th (or later) course: "${course.title}". Please enter verification:`;
        verificationGroup.classList.remove('d-none');
      } else {
        confirmationTitle.textContent = 'Confirm Enrollment';
        confirmationMessage.textContent = `Are you sure you want to enroll in "${course.title}"?`;
        verificationGroup.classList.add('d-none');
      }
      // Clear any previous input
      verificationInput.value = "";
      confirmationModal.classList.add('active');
    }

    async function executePendingAction() {
      if (!pendingAction) return;
      if (pendingAction.type === 'enroll') {
        let overflowData = "";
        if (pendingAction.requireVerification) {
          overflowData = verificationInput.value.trim();
          if (!overflowData) {
            alert("Please provide the required verification text.");
            return;
          }
        }
        await enrollInCourse(pendingAction.courseId, overflowData);
      }
      confirmationModal.classList.remove('active');
      pendingAction = null;
    }

    async function enrollInCourse(courseId, overflowData = "") {
      if (!currentUser) return;
      const course = allCourses.find(c => c.id === courseId);
      if (!course) return;
      try {
        const enrollmentRecord = {
          id: course.id,
          title: course.title,
          language: course.language,
          progress: 0,
          enrollmentDate: new Date().toISOString()
        };
        if (overflowData) {
          enrollmentRecord.overflow = overflowData;
        }
        await updateDoc(doc(db, "users", currentUser.uid), {
          enrolledCourses: arrayUnion(enrollmentRecord)
        });
        enrolledCourses.push(enrollmentRecord);
        displayEnrolledCourses();
        alert(`Successfully enrolled in "${course.title}"`);
      } catch (error) {
        console.error("Error enrolling in course:", error);
        alert("Failed to enroll in course. Please try again.");
      }
    }

    // CLASSMATES PAGE (unchanged filtering logic)
    function loadClassmatesPage() {
      let html = `
        <div class="card">
          <h2 class="card-title">My Classmates</h2>
          <div class="filter-group mb-3">
            <label for="classmate-filter">Filter by Course</label>
            <select id="classmate-filter" class="form-control">
              <option value="all">All Classmates</option>
              ${enrolledCourses.map(course => `<option value="${course.id}">${course.title}</option>`).join('')}
            </select>
          </div>
          <div class="classmates-grid" id="classmates-list"></div>
        </div>
      `;
      mainContent.innerHTML = html;
      document.getElementById('classmate-filter').addEventListener('change', filterClassmates);
      displayClassmates();
    }
    function displayClassmates(filterCourseId = 'all') {
      const classmatesList = document.getElementById('classmates-list');
      if (!classmatesList) return;
      let filteredClassmates = classmatesData;
      if (filterCourseId !== 'all') {
        filteredClassmates = classmatesData.filter(classmate => 
          classmate.enrolledCourses?.some(ec => ec.id === filterCourseId)
        );
      }
      if (filteredClassmates.length === 0) {
        classmatesList.innerHTML = '<p>No classmates found matching your filter.</p>';
        return;
      }
      classmatesList.innerHTML = '';
      filteredClassmates.forEach(classmate => {
        const card = document.createElement('div');
        card.className = 'course-card';
        card.innerHTML = `
          <div class="course-info">
            <div class="course-title">${classmate.name}</div>
          </div>
        `;
        classmatesList.appendChild(card);
      });
    }
    function filterClassmates() {
      const filterValue = document.getElementById('classmate-filter').value;
      displayClassmates(filterValue);
    }

    // PROFILE PAGE (show available courses with direct enrollment button)
    function loadProfilePage() {
      let html = `
        <div class="card">
          <h2 class="card-title">My Profile</h2>
          <div class="course-actions mt-3">
            <button class="btn btn-primary" onclick="window.location.href='profile.html'">Edit Profile</button>
          </div>
        </div>
        <div class="card mt-3">
          <h2 class="card-title">Available Courses</h2>
          <div id="available-courses">
            ${allCourses.map(course => `
              <div class="course-card">
                <div class="course-info">
                  <div class="course-title">${course.title}</div>
                  <div class="course-language">${course.language}</div>
                </div>
                <button class="enroll-btn" onclick="directEnroll('${course.id}')">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
            `).join('')}
          </div>
        </div>
      `;
      mainContent.innerHTML = html;
    }
    async function directEnroll(courseId) {
      // Use the same verification if needed
      const course = allCourses.find(c => c.id === courseId);
      if (!course) return;
      if (enrolledCourses.some(ec => ec.id === courseId)) {
        alert("You are already enrolled in this course.");
        return;
      }
      if (enrolledCourses.length >= 3) {
        // If 4th or later, require verification via confirmation modal
        showEnrollConfirmation(courseId);
      } else {
        await enrollInCourse(courseId);
        loadProfilePage();
      }
    }

    document.addEventListener('DOMContentLoaded', initApp);
    window.showEnrollConfirmation = showEnrollConfirmation;
    window.directEnroll = directEnroll;
  </script>
</body>
</html>
