<!DOCTYPE html>
<html lang="en" class="light-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HU Jama'aa - Course Registration</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #3f37c9;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #ef233c;
            --light: #f8f9fa;
            --dark: #212529;
            --text: #2b2d42;
            --text-light: #8d99ae;
            --bg: #ffffff;
            --card-bg: #f8f9fa;
            --border: #dee2e6;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --transition: all 0.3s ease;
            --qirat-gradient: linear-gradient(135deg, #4361ee, #3a0ca3);
            --hifz-gradient: linear-gradient(135deg, #f72585, #b5179e);
            --nezer-gradient: linear-gradient(135deg, #4cc9f0, #4895ef);
            --glass-bg: rgba(255, 255, 255, 0.2);
            --glass-border: rgba(255, 255, 255, 0.3);
        }

        .dark-theme {
            --primary: #4895ef;
            --primary-light: #4361ee;
            --secondary: #3f37c9;
            --accent: #f72585;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #ef233c;
            --light: #343a40;
            --dark: #f8f9fa;
            --text: #f8f9fa;
            --text-light: #adb5bd;
            --bg: #212529;
            --card-bg: #343a40;
            --border: #495057;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --glass-bg: rgba(0, 0, 0, 0.2);
            --glass-border: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            transition: var(--transition);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-circle {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.2;
            animation: float 15s infinite ease-in-out;
        }

        .circle-1 {
            width: 300px;
            height: 300px;
            background: var(--primary);
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .circle-2 {
            width: 400px;
            height: 400px;
            background: var(--accent);
            top: 60%;
            left: 30%;
            animation-delay: 3s;
        }

        .circle-3 {
            width: 250px;
            height: 250px;
            background: var(--success);
            top: 30%;
            left: 70%;
            animation-delay: 6s;
        }

        .circle-4 {
            width: 350px;
            height: 350px;
            background: var(--secondary);
            top: 70%;
            left: 80%;
            animation-delay: 9s;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) translateX(0);
            }
            50% {
                transform: translateY(-50px) translateX(50px);
            }
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 0 0 var(--radius) var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            position: relative;
            backdrop-filter: blur(10px);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 600;
            background: linear-gradient(to right, white, #f3f4f6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .user-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.5rem;
            box-shadow: var(--shadow);
            border: 3px solid rgba(255,255,255,0.3);
            transition: var(--transition);
        }

        .avatar:hover {
            transform: scale(1.1) rotate(10deg);
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(30deg) scale(1.1);
        }

        /* Tabs Navigation */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 25px;
            background: var(--card-bg);
            border: none;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            color: var(--text);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
            border: 1px solid var(--border);
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }

        .tab-btn:hover::before {
            left: 100%;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        /* Glass Card Effect */
        .glass-card {
            background: var(--glass-bg);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            transition: var(--transition);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        /* Course Selection - New Interactive Design */
        .course-selection {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }

        @media (max-width: 992px) {
            .course-selection {
                grid-template-columns: 1fr;
            }
        }

        .filter-panel {
            background: var(--glass-bg);
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .filter-panel h3 {
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group {
            margin-bottom: 20px;
        }

        .filter-group h4 {
            margin-bottom: 10px;
            color: var(--text-light);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-option:hover {
            background: rgba(67, 97, 238, 0.1);
        }

        .filter-option.active {
            background: var(--primary);
            color: white;
        }

        .filter-option .icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        .filter-option.active .icon {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .filter-option .checkmark {
            margin-left: auto;
            opacity: 0;
            transition: var(--transition);
        }

        .filter-option.active .checkmark {
            opacity: 1;
        }

        /* Course Grid - New Interactive Design */
        .courses-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .course-card {
            background: var(--glass-bg);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            position: relative;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .course-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--primary);
        }

        .course-card.qirat::before {
            background: var(--primary);
        }

        .course-card.hifz::before {
            background: var(--accent);
        }

        .course-card.nezer::before {
            background: var(--success);
        }

        .course-card:hover {
            transform: translateY(-10px) rotateX(5deg);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .course-card.over-limit {
            border-left: 5px solid var(--danger);
        }

        .course-card.over-limit::after {
            content: "Overloaded";
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--danger);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 2;
        }

        .course-header {
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .course-header.qirat {
            background: var(--qirat-gradient);
        }

        .course-header.hifz {
            background: var(--hifz-gradient);
        }

        .course-header.nezer {
            background: var(--nezer-gradient);
        }

        .course-header::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transform: rotate(30deg);
        }

        .course-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: white;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }

        .course-type {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            background: rgba(255,255,255,0.2);
            color: white;
            position: relative;
            z-index: 1;
        }

        .course-body {
            padding: 20px;
        }

        .course-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .meta-item i {
            color: var(--primary);
        }

        .course-description {
            margin-bottom: 20px;
            color: var(--text);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .course-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(67, 97, 238, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-accent {
            background: var(--accent);
            color: white;
        }

        .btn-accent:hover {
            background: #d1167e;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(247, 37, 133, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #3ab4d9;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(76, 201, 240, 0.3);
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            gap: 5px;
        }

        .badge-primary {
            background: var(--primary);
            color: white;
        }

        .badge-warning {
            background: var(--warning);
            color: white;
        }

        .badge-success {
            background: var(--success);
            color: white;
        }

        .badge-danger {
            background: var(--danger);
            color: white;
        }

        /* Progress */
        .progress-container {
            margin: 20px 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .progress-bar {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .qirat .progress-fill {
            background: var(--qirat-gradient);
        }

        .hifz .progress-fill {
            background: var(--hifz-gradient);
        }

        .nezer .progress-fill {
            background: var(--nezer-gradient);
        }

        /* Classmates Section */
        .classmates-section {
            margin-top: 40px;
        }

        .classmates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .classmate-card {
            text-align: center;
            background: var(--glass-bg);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
        }

        .classmate-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .classmate-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-weight: bold;
            color: white;
            font-size: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .classmate-card:hover .classmate-avatar {
            transform: scale(1.1) rotate(5deg);
        }

        .classmate-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .classmate-courses {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* Messages */
        .message {
            padding: 15px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            text-align: center;
            display: none;
            animation: fadeIn 0.5s ease;
            backdrop-filter: blur(10px);
        }

        .success-message {
            background: rgba(76, 201, 240, 0.2);
            color: white;
            border: 1px solid rgba(76, 201, 240, 0.3);
        }

        .error-message {
            background: rgba(239, 35, 60, 0.2);
            color: white;
            border: 1px solid rgba(239, 35, 60, 0.3);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: var(--glass-bg);
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
            padding: 30px;
            transform: translateY(20px);
            transition: var(--transition);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 15px 0;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid var(--glass-border);
        }

        /* Loading Spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--border);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .courses-container {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .classmates-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            h1 {
                font-size: 2rem;
            }

            .course-selection {
                grid-template-columns: 1fr;
            }

            .filter-panel {
                position: static;
            }
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.5);
            cursor: pointer;
            transition: var(--transition);
            z-index: 100;
            border: none;
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 15px 30px rgba(67, 97, 238, 0.7);
        }

        /* Course Path Visualization */
        .path-container {
            position: relative;
            height: 100px;
            margin: 40px 0;
            overflow: hidden;
        }

        .path-line {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--border);
            transform: translateY(-50%);
        }

        .path-progress {
            position: absolute;
            top: 50%;
            left: 0;
            height: 4px;
            background: var(--primary);
            transform: translateY(-50%);
            transition: width 1s ease;
        }

        .path-milestone {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--bg);
            border: 4px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .path-milestone.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
            transform: translate(-50%, -50%) scale(1.2);
        }

        .path-milestone.completed {
            border-color: var(--success);
            background: var(--success);
            color: white;
        }

        .path-label {
            position: absolute;
            top: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            white-space: nowrap;
        }

        /* 3D Flip Card for Course Details */
        .flip-card {
            perspective: 1000px;
            width: 100%;
            height: 300px;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .flip-card:hover .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: var(--radius);
            overflow: hidden;
        }

        .flip-card-back {
            background: var(--card-bg);
            transform: rotateY(180deg);
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* Pulse Animation for Important Elements */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Confetti Effect */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--accent);
            opacity: 0;
            z-index: 999;
            animation: confetti 5s ease-in-out;
        }

        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(1000px) rotate(720deg); opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation">
        <div class="bg-circle circle-1"></div>
        <div class="bg-circle circle-2"></div>
        <div class="bg-circle circle-3"></div>
        <div class="bg-circle circle-4"></div>
    </div>

    <!-- Header -->
    <header>
        <div class="container">
            <button class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon"></i>
            </button>
            <h1>Course Registration</h1>
            <div class="user-info">
                <div class="avatar" id="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <span id="username">Loading...</span>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Tabs Navigation -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="discover">
                <i class="fas fa-compass"></i> Discover
            </button>
            <button class="tab-btn" data-tab="my-courses">
                <i class="fas fa-book-open"></i> My Courses
            </button>
            <button class="tab-btn" data-tab="progress">
                <i class="fas fa-chart-line"></i> Progress
            </button>
            <button class="tab-btn" id="profile-btn">
                <i class="fas fa-user"></i> Profile
            </button>
        </div>

        <!-- Messages -->
        <div class="message success-message" id="success-message">
            <i class="fas fa-check-circle"></i> <span id="success-text">Course enrolled successfully!</span>
        </div>

        <div class="message error-message" id="error-message">
            <i class="fas fa-exclamation-circle"></i> <span id="error-text"></span>
        </div>

        <!-- Discover Tab - New Interactive Course Selection -->
        <div class="tab-content active" id="discover-tab">
            <div class="course-selection">
                <!-- Filter Panel -->
                <div class="filter-panel">
                    <h3><i class="fas fa-sliders-h"></i> Filters</h3>
                    
                    <div class="filter-group">
                        <h4><i class="fas fa-book"></i> Course Type</h4>
                        <div class="filter-options">
                            <div class="filter-option active" data-filter="type" data-value="all">
                                <div class="icon"><i class="fas fa-globe"></i></div>
                                <span>All Types</span>
                                <i class="fas fa-check checkmark"></i>
                            </div>
                            <div class="filter-option" data-filter="type" data-value="qirat">
                                <div class="icon"><i class="fas fa-book-open"></i></div>
                                <span>Qir'at</span>
                                <i class="fas fa-check checkmark"></i>
                            </div>
                            <div class="filter-option" data-filter="type" data-value="hifz">
                                <div class="icon"><i class="fas fa-quran"></i></div>
                                <span>Hifz</span>
                                <i class="fas fa-check checkmark"></i>
                            </div>
                            <div class="filter-option" data-filter="type" data-value="nezer">
                                <div class="icon"><i class="fas fa-graduation-cap"></i></div>
                                <span>Nezer</span>
                                <i class="fas fa-check checkmark"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <h4><i class="fas fa-venus-mars"></i> Gender</h4>
                        <div class="filter-options">
                            <div class="filter-option active" data-filter="gender" data-value="all">
                                <div class="icon"><i class="fas fa-users"></i></div>
                                <span>All Genders</span>
                                <i class="fas fa-check checkmark"></i>
                            </div>
                            <div class="filter-option" data-filter="gender" data-value="male">
                                <div class="icon"><i class="fas fa-mars"></i></div>
                                <span>Male</span>
                                <i class="fas fa-check checkmark"></i>
                            </div>
                            <div class="filter-option" data-filter="gender" data-value="female">
                                <div class="icon"><i class="fas fa-venus"></i></div>
                                <span>Female</span>
                                <i class="fas fa-check checkmark"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <h4><i class="fas fa-language"></i> Language</h4>
                        <div class="filter-options">
                            <div class="filter-option active" data-filter="language" data-value="all">
                                <div class="icon"><i class="fas fa-globe"></i></div>
                                <span>All Languages</span>
                                <i class="fas fa-check checkmark"></i>
                            </div>
                            <div class="filter-option" data-filter="language" data-value="amharic">
                                <div class="icon"><i class="fas fa-font"></i></div>
                                <span>Amharic</span>
                                <i class="fas fa-check checkmark"></i>
                            </div>
                            <div class="filter-option" data-filter="language" data-value="oromifa">
                                <div class="icon"><i class="fas fa-font"></i></div>
                                <span>Oromifa</span>
                                <i class="fas fa-check checkmark"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <h4><i class="fas fa-layer-group"></i> Level</h4>
                        <div class="filter-options">
                            <div class="filter-option active" data-filter="level" data-value="all">
                                <div class="icon"><i class="fas fa-star"></i></div>
                                <span>All Levels</span>
                                <i class="fas fa-check checkmark"></i>
                            </div>
                            <div class="filter-option" data-filter="level" data-value="fresh">
                                <div class="icon"><i class="fas fa-seedling"></i></div>
                                <span>Fresh</span>
                                <i class="fas fa-check checkmark"></i>
                            </div>
                            <div class="filter-option" data-filter="level" data-value="senior">
                                <div class="icon"><i class="fas fa-tree"></i></div>
                                <span>Senior</span>
                                <i class="fas fa-check checkmark"></i>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary w-100 mt-3" id="apply-filters">
                        <i class="fas fa-filter"></i> Apply Filters
                    </button>
                </div>
                
                <!-- Courses Grid -->
                <div class="courses-container" id="courses-container">
                    <!-- Courses will be loaded here dynamically -->
                </div>
            </div>
        </div>

        <!-- My Courses Tab -->
        <div class="tab-content" id="my-courses-tab">
            <div class="loading" id="courses-loading">
                <div class="loading-spinner"></div>
            </div>
            <div id="courses-content" style="display: none;">
                <h2>My Learning Journey</h2>
                <p>Manage your enrolled courses and track your progress</p>
                
                <div class="path-container">
                    <div class="path-line"></div>
                    <div class="path-progress" id="path-progress" style="width: 0%"></div>
                    <div class="path-milestone" style="left: 0%;">
                        <i class="fas fa-book"></i>
                        <div class="path-label">Start</div>
                    </div>
                    <div class="path-milestone" style="left: 25%;">
                        <i class="fas fa-quran"></i>
                        <div class="path-label">25%</div>
                    </div>
                    <div class="path-milestone" style="left: 50%;">
                        <i class="fas fa-pray"></i>
                        <div class="path-label">50%</div>
                    </div>
                    <div class="path-milestone" style="left: 75%;">
                        <i class="fas fa-star"></i>
                        <div class="path-label">75%</div>
                    </div>
                    <div class="path-milestone" style="left: 100%;">
                        <i class="fas fa-graduation-cap"></i>
                        <div class="path-label">Complete</div>
                    </div>
                </div>
                
                <div class="courses-container" id="enrolled-courses">
                    <!-- Enrolled courses will be loaded here -->
                </div>
                
                <div class="classmates-section" id="classmates-section">
                    <h3><i class="fas fa-users"></i> Your Study Community</h3>
                    <p>Connect with classmates in your courses</p>
                    <div class="classmates-grid" id="classmates-grid">
                        <!-- Classmates will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Tab -->
        <div class="tab-content" id="progress-tab">
            <div class="glass-card">
                <h2>Your Learning Progress</h2>
                <p>Track your course completion and achievements</p>
                
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Overall Completion</span>
                        <span id="progress-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-bar" style="width: 0%"></div>
                    </div>
                </div>
                
                <div id="progress-stats" class="mt-4">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="glass-card text-center">
                            <h3>Enrolled</h3>
                            <p class="text-2xl" id="enrolled-count">0</p>
                        </div>
                        <div class="glass-card text-center">
                            <h3>Completed</h3>
                            <p class="text-2xl" id="completed-count">0</p>
                        </div>
                        <div class="glass-card text-center">
                            <h3>In Progress</h3>
                            <p class="text-2xl" id="inprogress-count">0</p>
                        </div>
                        <div class="glass-card text-center">
                            <h3>Avg. Progress</h3>
                            <p class="text-2xl" id="avg-progress">0%</p>
                        </div>
                    </div>
                    
                    <h3>Course Breakdown</h3>
                    <div id="progress-courses">
                        <!-- Progress by course will be shown here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" id="help-fab">
        <i class="fas fa-question"></i>
    </button>

    <!-- Course Details Modal -->
    <div class="modal" id="course-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="course-modal-title">Course Details</h3>
                <button class="modal-close" id="close-course-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <div class="course-header qirat" id="modal-course-header">
                                <h3 class="course-title" id="modal-course-title">Course Title</h3>
                                <span class="course-type" id="modal-course-type">Qir'at</span>
                            </div>
                            <div class="course-body">
                                <div class="course-meta">
                                    <div class="meta-item">
                                        <i class="fas fa-venus-mars"></i>
                                        <span id="modal-course-gender">All Genders</span>
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-language"></i>
                                        <span id="modal-course-language">Amharic</span>
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-layer-group"></i>
                                        <span id="modal-course-level">All Levels</span>
                                    </div>
                                </div>
                                <div class="course-description" id="modal-course-description">
                                    This course covers the fundamental principles of Qir'at with a focus on proper recitation techniques.
                                </div>
                                <div class="progress-container">
                                    <div class="progress-label">
                                        <span>Class Capacity</span>
                                        <span>15/20</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 75%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flip-card-back">
                            <h4>About This Course</h4>
                            <p id="modal-course-about">Detailed information about the course content, objectives, and requirements will appear here.</p>
                            
                            <h4 class="mt-3">Instructor</h4>
                            <div class="d-flex align-center gap-3">
                                <div class="avatar small">
                                    <i class="fas fa-user-tie"></i>
                                </div>
                                <div>
                                    <h5 id="modal-course-instructor">Sheikh Mohammed Ali</h5>
                                    <p class="text-sm">Senior Instructor</p>
                                </div>
                            </div>
                            
                            <h4 class="mt-3">Schedule</h4>
                            <p id="modal-course-schedule">Monday & Wednesday, 2:00 PM - 4:00 PM</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-enroll-btn">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-primary" id="enroll-btn">
                    <i class="fas fa-plus"></i> Enroll Now
                </button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmation-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Confirm Enrollment</h3>
                <button class="modal-close" id="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmation-text">You're about to enroll in your 4th course. Please confirm you can handle this workload?</p>
                <div class="form-group mt-3" id="reason-field" style="display: none;">
                    <label for="enrollment-reason">What makes you think you can handle more than 3 courses?</label>
                    <textarea id="enrollment-reason" class="form-control" placeholder="Explain your reasoning..." rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-btn">
                    <i class="fas fa-arrow-left"></i> Go Back
                </button>
                <button class="btn btn-primary" id="confirm-btn">
                    <i class="fas fa-check"></i> Confirm
                </button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="help-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-question-circle"></i> Registration Help</h3>
                <button class="modal-close" id="close-help-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="accordion">
                    <div class="accordion-item">
                        <button class="accordion-button">
                            <i class="fas fa-book"></i> How do I enroll in a course?
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="accordion-content">
                            <p>Browse available courses in the Discover tab, click on a course to view details, then click "Enroll Now" to register. You'll receive a confirmation once enrolled.</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-button">
                            <i class="fas fa-user-graduate"></i> What's the course limit?
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="accordion-content">
                            <p>You can enroll in up to 3 courses by default. If you wish to take more, you'll need to provide justification for the additional workload.</p>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-button">
                            <i class="fas fa-calendar-check"></i> How do I track my progress?
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="accordion-content">
                            <p>The Progress tab shows your overall completion rate and detailed progress for each course. Your instructors will update your progress regularly.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="close-help-btn">
                    <i class="fas fa-check"></i> Got it!
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase and App Script -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBQyNVWh1BtCkXlBfuS7jHAa36FTklZayo",
            authDomain: "pharma-quiz-b5a07.firebaseapp.com",
            databaseURL: "https://pharma-quiz-b5a07-default-rtdb.firebaseio.com",
            projectId: "pharma-quiz-b5a07",
            storageBucket: "pharma-quiz-b5a07.firebasestorage.app",
            messagingSenderId: "161067776789",
            appId: "1:161067776789:web:88b8a61145dc5f5c31471c",
            measurementId: "G-3QRQE9HQFB"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // All available courses with enhanced details
        const allCourses = [
            // Qir'at courses
            { 
                id: 'q1', 
                title: 'Sifetu Solah', 
                type: 'qirat', 
                language: 'amharic', 
                level: 'all', 
                gender: 'all',
                description: 'Master the proper recitation of daily prayers with correct tajweed rules.',
                about: 'This course focuses on the correct pronunciation and recitation of the daily prayers (Salah). Students will learn the proper articulation points, characteristics of Arabic letters, and the rules of tajweed as applied to prayer recitation.',
                instructor: 'Sheikh Ahmed Mohammed',
                schedule: 'Monday & Wednesday, 9:00 AM - 11:00 AM',
                capacity: 20,
                enrolled: 15,
                duration: '8 weeks'
            },
            { 
                id: 'q2', 
                title: 'Usulu Selasah', 
                type: 'qirat', 
                language: 'amharic', 
                level: 'all', 
                gender: 'all',
                description: 'Learn the three fundamental principles of Islam with proper recitation.',
                about: 'This course covers the three fundamental principles of Islam with emphasis on proper recitation and understanding. Students will study the text "Thalatha al-Usool" (The Three Principles) while perfecting their tajweed.',
                instructor: 'Sheikh Yusuf Ibrahim',
                schedule: 'Tuesday & Thursday, 2:00 PM - 4:00 PM',
                capacity: 15,
                enrolled: 10,
                duration: '6 weeks'
            },
            // Hifz courses
            { 
                id: 'h1', 
                title: 'Hifz: Juz Amma', 
                type: 'hifz', 
                language: 'amharic', 
                level: 'fresh', 
                gender: 'female',
                description: 'Begin your memorization journey with the 30th chapter of the Quran.',
                about: 'This course guides students through memorizing the 30th chapter (Juz) of the Quran, starting with Surah An-Naba and ending with Surah An-Nas. Emphasis is placed on proper pronunciation, memorization techniques, and retention strategies.',
                instructor: 'Sheikha Amina Hassan',
                schedule: 'Sunday & Wednesday, 8:00 AM - 10:00 AM',
                capacity: 12,
                enrolled: 8,
                duration: '12 weeks'
            },
            // Nezer courses
            { 
                id: 'n1', 
                title: 'Nezer Fundamentals', 
                type: 'nezer', 
                language: 'amharic', 
                level: 'fresh', 
                gender: 'male',
                description: 'Introduction to Quranic recitation with proper tajweed rules.',
                about: 'This foundational course introduces students to the science of tajweed (proper Quranic recitation). Students will learn the articulation points of Arabic letters, characteristics of letters, and basic tajweed rules through practical application.',
                instructor: 'Sheikh Omar Abdullah',
                schedule: 'Saturday & Tuesday, 3:00 PM - 5:00 PM',
                capacity: 18,
                enrolled: 12,
                duration: '10 weeks'
            },
            // Add more courses with similar detailed structure
        ];

        // Current user data
        let currentUser = {
            id: '',
            name: 'Guest',
            email: '',
            gender: 'male',
            level: 'fresh',
            enrolledCourses: [],
            overloadedCourses: [],
            completedCourses: [],
            progress: {}
        };

        // DOM elements
        const courseContainer = document.getElementById('courses-container');
        const enrolledCoursesGrid = document.getElementById('enrolled-courses');
        const classmatesGrid = document.getElementById('classmates-grid');
        const confirmationModal = document.getElementById('confirmation-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const cancelBtn = document.getElementById('cancel-btn');
        const confirmBtn = document.getElementById('confirm-btn');
        const confirmationText = document.getElementById('confirmation-text');
        const reasonField = document.getElementById('reason-field');
        const successMessage = document.getElementById('success-message');
        const successText = document.getElementById('success-text');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const themeToggle = document.getElementById('theme-toggle');
        const userAvatar = document.getElementById('user-avatar');
        const usernameElement = document.getElementById('username');
        const profileBtn = document.getElementById('profile-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const coursesLoading = document.getElementById('courses-loading');
        const coursesContent = document.getElementById('courses-content');
        const progressBar = document.getElementById('progress-bar');
        const pathProgress = document.getElementById('path-progress');
        const enrolledCount = document.getElementById('enrolled-count');
        const completedCount = document.getElementById('completed-count');
        const inProgressCount = document.getElementById('inprogress-count');
        const avgProgress = document.getElementById('avg-progress');
        const progressPercent = document.getElementById('progress-percent');
        const progressCourses = document.getElementById('progress-courses');
        const courseModal = document.getElementById('course-modal');
        const closeCourseModal = document.getElementById('close-course-modal');
        const cancelEnrollBtn = document.getElementById('cancel-enroll-btn');
        const enrollBtn = document.getElementById('enroll-btn');
        const modalCourseTitle = document.getElementById('modal-course-title');
        const modalCourseType = document.getElementById('modal-course-type');
        const modalCourseHeader = document.getElementById('modal-course-header');
        const modalCourseGender = document.getElementById('modal-course-gender');
        const modalCourseLanguage = document.getElementById('modal-course-language');
        const modalCourseLevel = document.getElementById('modal-course-level');
        const modalCourseDescription = document.getElementById('modal-course-description');
        const modalCourseAbout = document.getElementById('modal-course-about');
        const modalCourseInstructor = document.getElementById('modal-course-instructor');
        const modalCourseSchedule = document.getElementById('modal-course-schedule');
        const helpFab = document.getElementById('help-fab');
        const helpModal = document.getElementById('help-modal');
        const closeHelpModal = document.getElementById('close-help-modal');
        const closeHelpBtn = document.getElementById('close-help-btn');
        const applyFiltersBtn = document.getElementById('apply-filters');
        const filterOptions = document.querySelectorAll('.filter-option');

        // Track pending course
        let pendingCourse = null;
        let currentFilters = {
            type: 'all',
            gender: 'all',
            language: 'all',
            level: 'all'
        };

        // Initialize the page
        function init() {
            // Check authentication state
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    // User is signed in
                    currentUser.id = user.uid;
                    currentUser.email = user.email;
                    usernameElement.textContent = user.displayName || user.email;
                    userAvatar.textContent = user.displayName ? 
                        user.displayName.split(' ').map(n => n[0]).join('') : 
                        user.email.charAt(0).toUpperCase();
                    
                    // Load user data from Firestore
                    await loadUserData();
                    
                    // Setup UI
                    setupUI();
                } else {
                    // No user is signed in, redirect to login
                    window.location.href = 'login.html';
                }
            });

            setupEventListeners();
            checkTheme();
        }

        // Load user data from Firestore
        async function loadUserData() {
            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.id));
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    currentUser = {
                        ...currentUser,
                        ...userData,
                        enrolledCourses: userData.enrolledCourses || [],
                        overloadedCourses: userData.overloadedCourses || [],
                        completedCourses: userData.completedCourses || [],
                        progress: userData.progress || {},
                        gender: userData.gender || 'male',
                        level: userData.level || 'fresh'
                    };
                    
                    // Update UI with user data
                    updateUI();
                } else {
                    // Create new user document if it doesn't exist
                    await setDoc(doc(db, 'users', currentUser.id), {
                        name: currentUser.name,
                        email: currentUser.email,
                        gender: currentUser.gender,
                        level: currentUser.level,
                        enrolledCourses: [],
                        overloadedCourses: [],
                        completedCourses: [],
                        progress: {},
                        createdAt: new Date()
                    });
                }
            } catch (error) {
                showError("Error loading user data: " + error.message);
                console.error("Error loading user data:", error);
            }
        }

        // Save user data to Firestore
        async function saveUserData() {
            try {
                await updateDoc(doc(db, 'users', currentUser.id), {
                    name: currentUser.name,
                    gender: currentUser.gender,
                    level: currentUser.level,
                    enrolledCourses: currentUser.enrolledCourses,
                    overloadedCourses: currentUser.overloadedCourses,
                    completedCourses: currentUser.completedCourses,
                    progress: currentUser.progress,
                    lastUpdated: new Date()
                });
            } catch (error) {
                showError("Error saving user data: " + error.message);
                console.error("Error saving user data:", error);
            }
        }

        // Setup UI based on user data
        function setupUI() {
            // Set initial filters based on user data
            updateFilterOptions();
            
            // Load courses based on filters
            loadFilteredCourses();
            
            // Load enrolled courses
            loadEnrolledCourses();
            
            // Load progress
            loadProgress();
        }

        // Update UI elements
        function updateUI() {
            usernameElement.textContent = currentUser.name || currentUser.email;
            userAvatar.textContent = currentUser.name ? 
                currentUser.name.split(' ').map(n => n[0]).join('') : 
                currentUser.email.charAt(0).toUpperCase();
        }

        // Update filter options based on user data
        function updateFilterOptions() {
            // Set gender filter based on user gender
            document.querySelector(`.filter-option[data-filter="gender"][data-value="${currentUser.gender}"]`).classList.add('active');
            document.querySelector(`.filter-option[data-filter="gender"][data-value="all"]`).classList.remove('active');
            
            // Set level filter based on user level
            document.querySelector(`.filter-option[data-filter="level"][data-value="${currentUser.level}"]`).classList.add('active');
            document.querySelector(`.filter-option[data-filter="level"][data-value="all"]`).classList.remove('active');
            
            // Update current filters
            currentFilters.gender = currentUser.gender;
            currentFilters.level = currentUser.level;
        }

        // Load courses based on current filters
        function loadFilteredCourses() {
            courseContainer.innerHTML = '';
            
            // Filter courses
            let filteredCourses = allCourses.filter(course => {
                return (currentFilters.type === 'all' || course.type === currentFilters.type) &&
                       (currentFilters.gender === 'all' || course.gender === currentFilters.gender || course.type === 'qirat') &&
                       (currentFilters.language === 'all' || course.language === currentFilters.language) &&
                       (currentFilters.level === 'all' || course.level === currentFilters.level) &&
                       !currentUser.enrolledCourses.includes(course.id);
            });
            
            if (filteredCourses.length === 0) {
                courseContainer.innerHTML = `
                    <div class="glass-card" style="grid-column: 1/-1; text-align: center; padding: 40px;">
                        <i class="fas fa-book-open" style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;"></i>
                        <h3>No courses match your current filters</h3>
                        <p>Try adjusting your filters or check back later for new courses</p>
                        <button class="btn btn-primary mt-3" id="reset-filters">
                            <i class="fas fa-sync-alt"></i> Reset Filters
                        </button>
                    </div>
                `;
                
                document.getElementById('reset-filters').addEventListener('click', resetFilters);
                return;
            }
            
            // Display filtered courses
            filteredCourses.forEach(course => {
                const courseCard = document.createElement('div');
                courseCard.className = `course-card ${course.type}`;
                courseCard.dataset.id = course.id;
                
                // Determine type-specific details
                let typeIcon, typeClass;
                if (course.type === 'qirat') {
                    typeIcon = 'book-open';
                    typeClass = 'qirat';
                } else if (course.type === 'hifz') {
                    typeIcon = 'quran';
                    typeClass = 'hifz';
                } else {
                    typeIcon = 'graduation-cap';
                    typeClass = 'nezer';
                }
                
                courseCard.innerHTML = `
                    <div class="course-header ${typeClass}">
                        <h3 class="course-title">${course.title}</h3>
                        <span class="course-type">
                            <i class="fas fa-${typeIcon}"></i> ${course.type.charAt(0).toUpperCase() + course.type.slice(1)}
                        </span>
                    </div>
                    <div class="course-body">
                        <div class="course-description">${course.description}</div>
                        <div class="course-meta">
                            <div class="meta-item">
                                <i class="fas fa-${course.gender === 'male' ? 'mars' : 'venus'}"></i>
                                <span>${course.gender === 'all' ? 'All Genders' : course.gender === 'male' ? 'Male' : 'Female'}</span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-language"></i>
                                <span>${course.language.charAt(0).toUpperCase() + course.language.slice(1)}</span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-layer-group"></i>
                                <span>${course.level === 'all' ? 'All Levels' : course.level === 'fresh' ? 'Fresh' : 'Senior'}</span>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>Available Spots</span>
                                <span>${course.capacity - course.enrolled}/${course.capacity}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${(course.enrolled / course.capacity) * 100}%"></div>
                            </div>
                        </div>
                        <div class="course-actions">
                            <button class="btn btn-outline view-details-btn">
                                <i class="fas fa-info-circle"></i> Details
                            </button>
                            <button class="btn btn-primary enroll-btn">
                                <i class="fas fa-plus"></i> Enroll
                            </button>
                        </div>
                    </div>
                `;
                
                courseContainer.appendChild(courseCard);
            });
            
            // Add event listeners to course cards
            document.querySelectorAll('.view-details-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const courseId = e.target.closest('.course-card').dataset.id;
                    showCourseDetails(courseId);
                });
            });
            
            document.querySelectorAll('.enroll-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const courseId = e.target.closest('.course-card').dataset.id;
                    initiateEnrollment(courseId);
                });
            });
        }

        // Reset all filters
        function resetFilters() {
            document.querySelectorAll('.filter-option').forEach(option => {
                option.classList.remove('active');
                if (option.dataset.value === 'all') {
                    option.classList.add('active');
                }
            });
            
            // Reset gender and level to user defaults
            document.querySelector(`.filter-option[data-filter="gender"][data-value="${currentUser.gender}"]`).classList.add('active');
            document.querySelector(`.filter-option[data-filter="gender"][data-value="all"]`).classList.remove('active');
            
            document.querySelector(`.filter-option[data-filter="level"][data-value="${currentUser.level}"]`).classList.add('active');
            document.querySelector(`.filter-option[data-filter="level"][data-value="all"]`).classList.remove('active');
            
            currentFilters = {
                type: 'all',
                gender: currentUser.gender,
                language: 'all',
                level: currentUser.level
            };
            
            loadFilteredCourses();
        }

        // Show course details in modal
        function showCourseDetails(courseId) {
            const course = allCourses.find(c => c.id === courseId);
            if (!course) return;
            
            // Set modal content
            modalCourseTitle.textContent = course.title;
            modalCourseType.textContent = course.type.charAt(0).toUpperCase() + course.type.slice(1);
            modalCourseGender.textContent = course.gender === 'all' ? 'All Genders' : course.gender === 'male' ? 'Male' : 'Female';
            modalCourseLanguage.textContent = course.language.charAt(0).toUpperCase() + course.language.slice(1);
            modalCourseLevel.textContent = course.level === 'all' ? 'All Levels' : course.level === 'fresh' ? 'Fresh' : 'Senior';
            modalCourseDescription.textContent = course.description;
            modalCourseAbout.textContent = course.about;
            modalCourseInstructor.textContent = course.instructor;
            modalCourseSchedule.textContent = course.schedule;
            
            // Set header class based on course type
            modalCourseHeader.className = `course-header ${course.type}`;
            
            // Set enroll button data
            enrollBtn.dataset.courseId = course.id;
            
            // Show modal
            courseModal.classList.add('active');
        }

        // Initiate enrollment process
        function initiateEnrollment(courseId) {
            const course = allCourses.find(c => c.id === courseId);
            if (!course) {
                showError("Invalid course selected");
                return;
            }

            // Check if already enrolled
            if (currentUser.enrolledCourses.includes(courseId)) {
                showError("You are already enrolled in this course!");
                return;
            }

            // Check course capacity
            if (course.enrolled >= course.capacity) {
                showError("This course has reached maximum capacity");
                return;
            }

            // Store pending course
            pendingCourse = courseId;

            // Check if over 3 courses
            if (currentUser.enrolledCourses.length >= 3) {
                // Show special confirmation modal for 4th+ course
                confirmationText.textContent = `You're about to enroll in your ${currentUser.enrolledCourses.length + 1}th course (${course.title}). Please confirm you can handle this workload?`;
                reasonField.style.display = 'block';
                confirmationModal.classList.add('active');
            } else {
                // Show general confirmation in the course modal
                enrollBtn.innerHTML = `<i class="fas fa-check"></i> Confirm Enrollment`;
            }
        }

        // Load enrolled courses
        async function loadEnrolledCourses() {
            coursesLoading.style.display = 'flex';
            coursesContent.style.display = 'none';
            
            enrolledCoursesGrid.innerHTML = '';
            
            if (currentUser.enrolledCourses.length === 0) {
                enrolledCoursesGrid.innerHTML = `
                    <div class="glass-card" style="grid-column: 1/-1; text-align: center; padding: 40px;">
                        <i class="fas fa-book-open" style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;"></i>
                        <h3>You haven't enrolled in any courses yet</h3>
                        <p>Browse available courses and start your learning journey today</p>
                        <button class="btn btn-primary mt-3" id="browse-courses-btn">
                            <i class="fas fa-compass"></i> Browse Courses
                        </button>
                    </div>
                `;
                
                document.getElementById('browse-courses-btn').addEventListener('click', () => {
                    document.querySelector('.tab-btn[data-tab="discover"]').click();
                });
                
                coursesLoading.style.display = 'none';
                coursesContent.style.display = 'block';
                return;
            }

            // Update path visualization
            const totalCourses = currentUser.enrolledCourses.length;
            const completedCourses = currentUser.completedCourses.length;
            const progressPercentage = totalCourses > 0 ? Math.round((completedCourses / totalCourses) * 100) : 0;
            pathProgress.style.width = `${progressPercentage}%`;
            
            // Update path milestones
            const milestones = document.querySelectorAll('.path-milestone');
            milestones.forEach((milestone, index) => {
                const percentage = index * 25;
                milestone.classList.remove('active', 'completed');
                
                if (percentage < progressPercentage) {
                    milestone.classList.add('completed');
                } else if (percentage === Math.round(progressPercentage / 25) * 25) {
                    milestone.classList.add('active');
                }
            });

            currentUser.enrolledCourses.forEach((courseId, index) => {
                const course = allCourses.find(c => c.id === courseId);
                if (course) {
                    const isOverLimit = index >= 3;
                    const isOverloaded = currentUser.overloadedCourses.includes(courseId);
                    const isCompleted = currentUser.completedCourses.includes(courseId);
                    const progress = currentUser.progress[courseId] || 0;
                    
                    // Determine type-specific details
                    let typeIcon, typeClass, typeName;
                    if (course.type === 'qirat') {
                        typeIcon = 'book-open';
                        typeClass = 'qirat';
                        typeName = 'Qir\'at';
                    } else if (course.type === 'hifz') {
                        typeIcon = 'quran';
                        typeClass = 'hifz';
                        typeName = 'Hifz';
                    } else {
                        typeIcon = 'graduation-cap';
                        typeClass = 'nezer';
                        typeName = 'Nezer';
                    }
                    
                    const courseCard = document.createElement('div');
                    courseCard.className = `course-card ${typeClass} ${isOverLimit ? 'over-limit' : ''}`;
                    
                    courseCard.innerHTML = `
                        <div class="course-header ${typeClass}">
                            <h3 class="course-title">${course.title}</h3>
                            ${isOverloaded ? '<span class="badge badge-warning"><i class="fas fa-exclamation-triangle"></i> Overloaded</span>' : ''}
                            ${isCompleted ? '<span class="badge badge-success"><i class="fas fa-check"></i> Completed</span>' : ''}
                        </div>
                        <div class="course-body">
                            <div class="course-meta">
                                <span class="badge badge-${typeClass}">
                                    <i class="fas fa-${typeIcon}"></i>
                                    ${typeName}
                                </span>
                                <span class="badge badge-${typeClass}">
                                    <i class="fas fa-language"></i>
                                    ${course.language.charAt(0).toUpperCase() + course.language.slice(1)}
                                </span>
                            </div>
                            <div class="course-description">${course.description}</div>
                            <div class="progress-container">
                                <div class="progress-label">
                                    <span>Your Progress</span>
                                    <span>${progress}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progress}%"></div>
                                </div>
                            </div>
                            <div class="course-actions">
                                <button class="btn btn-outline view-course-btn">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                ${!isCompleted ? `
                                    <button class="btn btn-${typeClass} progress-btn">
                                        <i class="fas fa-tasks"></i> Update Progress
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                    
                    enrolledCoursesGrid.appendChild(courseCard);
                }
            });
            
            // Add event listeners to enrolled course buttons
            document.querySelectorAll('.view-course-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const courseId = e.target.closest('.course-card').dataset.id;
                    // In a real app, this would navigate to the course page
                    showSuccess(`Viewing course details would open here`);
                });
            });
            
            document.querySelectorAll('.progress-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const courseId = e.target.closest('.course-card').dataset.id;
                    // In a real app, this would open a progress update modal
                    showSuccess(`Progress update feature would open here`);
                });
            });
            
            // Load classmates
            loadClassmates();
            
            coursesLoading.style.display = 'none';
            coursesContent.style.display = 'block';
        }

        // Load classmates
        async function loadClassmates() {
            classmatesGrid.innerHTML = '';
            
            try {
                // In a real app, you would fetch classmates from Firestore
                // For now, we'll use mock data
                const mockClassmates = [
                    { id: 's1', name: 'Ahmed Mohammed', courses: ['q1', 'h1'], avatar: 'AM' },
                    { id: 's2', name: 'Fatima Ali', courses: ['q5', 'n2'], avatar: 'FA' },
                    { id: 's3', name: 'Mohammed Hassan', courses: ['h1', 'n1'], avatar: 'MH' },
                    { id: 's4', name: 'Amina Abdi', courses: ['q1', 'h2'], avatar: 'AA' },
                    { id: 's5', name: 'Omar Yusuf', courses: ['q5', 'n1'], avatar: 'OY' }
                ];
                
                // Find classmates in the same courses
                const sharedClassmates = mockClassmates.filter(classmate => 
                    classmate.courses.some(courseId => currentUser.enrolledCourses.includes(courseId))
                );

                if (sharedClassmates.length === 0) {
                    classmatesGrid.innerHTML = `
                        <div class="glass-card" style="grid-column: 1/-1; text-align: center; padding: 40px;">
                            <i class="fas fa-users" style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;"></i>
                            <h3>No classmates found in your courses</h3>
                            <p>As more students enroll, you'll see them here</p>
                        </div>
                    `;
                    return;
                }

                sharedClassmates.forEach(classmate => {
                    const sharedCourseCount = classmate.courses.filter(c => currentUser.enrolledCourses.includes(c)).length;
                    
                    const classmateCard = document.createElement('div');
                    classmateCard.className = 'classmate-card';
                    classmateCard.innerHTML = `
                        <div class="classmate-avatar">${classmate.avatar}</div>
                        <h4 class="classmate-name">${classmate.name}</h4>
                        <p class="classmate-courses">${sharedCourseCount} shared course${sharedCourseCount > 1 ? 's' : ''}</p>
                        <button class="btn btn-outline btn-sm mt-2 connect-btn">
                            <i class="fas fa-user-plus"></i> Connect
                        </button>
                    `;
                    
                    classmatesGrid.appendChild(classmateCard);
                });
                
                // Add event listeners to connect buttons
                document.querySelectorAll('.connect-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const classmateName = e.target.closest('.classmate-card').querySelector('.classmate-name').textContent;
                        showSuccess(`Connection request sent to ${classmateName}`);
                    });
                });
            } catch (error) {
                console.error("Error loading classmates:", error);
            }
        }

        // Load progress data
        async function loadProgress() {
            const totalCourses = currentUser.enrolledCourses.length;
            const completedCourses = currentUser.completedCourses.length;
            const inProgressCourses = totalCourses - completedCourses;
            const progressPercentage = totalCourses > 0 ? Math.round((completedCourses / totalCourses) * 100) : 0;
            
            // Calculate average progress across all courses
            let totalProgress = 0;
            currentUser.enrolledCourses.forEach(courseId => {
                totalProgress += currentUser.progress[courseId] || 0;
            });
            const avgProgressPercentage = totalCourses > 0 ? Math.round(totalProgress / totalCourses) : 0;
            
            // Update progress bar
            progressBar.style.width = `${progressPercentage}%`;
            pathProgress.style.width = `${progressPercentage}%`;
            
            // Update stats
            enrolledCount.textContent = totalCourses;
            completedCount.textContent = completedCourses;
            inProgressCount.textContent = inProgressCourses;
            avgProgress.textContent = `${avgProgressPercentage}%`;
            progressPercent.textContent = `${progressPercentage}%`;
            
            // Update course breakdown
            progressCourses.innerHTML = '';
            
            if (totalCourses === 0) {
                progressCourses.innerHTML = `
                    <div class="glass-card text-center" style="padding: 30px;">
                        <i class="fas fa-book-open" style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;"></i>
                        <h3>No courses enrolled</h3>
                        <p>Your progress will appear here once you enroll in courses</p>
                    </div>
                `;
                return;
            }
            
            currentUser.enrolledCourses.forEach(courseId => {
                const course = allCourses.find(c => c.id === courseId);
                if (course) {
                    const isCompleted = currentUser.completedCourses.includes(courseId);
                    const progress = currentUser.progress[courseId] || 0;
                    
                    // Determine type-specific details
                    let typeClass;
                    if (course.type === 'qirat') {
                        typeClass = 'qirat';
                    } else if (course.type === 'hifz') {
                        typeClass = 'hifz';
                    } else {
                        typeClass = 'nezer';
                    }
                    
                    const courseProgress = document.createElement('div');
                    courseProgress.className = 'glass-card';
                    courseProgress.style.marginBottom = '15px';
                    courseProgress.style.padding = '15px';
                    courseProgress.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="margin: 0;">${course.title}</h4>
                            <span class="badge badge-${typeClass}">${course.type.charAt(0).toUpperCase() + course.type.slice(1)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>${isCompleted ? 'Completed' : 'In Progress'}</span>
                            <span>${progress}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill ${typeClass}" style="width: ${progress}%"></div>
                        </div>
                    `;
                    progressCourses.appendChild(courseProgress);
                }
            });
        }

        // Confirm enrollment after warning (for 4th+ courses)
        async function confirmEnrollment() {
            const reason = document.getElementById('enrollment-reason').value;
            if (currentUser.enrolledCourses.length >= 3 && !reason) {
                showError('Please provide a reason for taking more than 3 courses');
                return;
            }

            try {
                // Add to overloaded courses if this is the 4th+ course
                if (currentUser.enrolledCourses.length >= 3) {
                    currentUser.overloadedCourses.push(pendingCourse);
                }
                
                // Add to enrolled courses
                currentUser.enrolledCourses.push(pendingCourse);
                
                // Initialize progress for this course
                currentUser.progress[pendingCourse] = 0;
                
                // Save to Firebase
                await saveUserData();
                
                // Update UI
                loadFilteredCourses();
                loadEnrolledCourses();
                loadProgress();
                
                // Show success message with confetti
                showSuccess('Course enrolled successfully!', true);
                
                // Close modals
                confirmationModal.classList.remove('active');
                courseModal.classList.remove('active');
            } catch (error) {
                showError("Error enrolling in course: " + error.message);
            }
        }

        // Show success message
        function showSuccess(message, withConfetti = false) {
            successText.textContent = message;
            successMessage.style.display = 'block';
            
            if (withConfetti) {
                createConfetti();
            }
            
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }

        // Create confetti effect
        function createConfetti() {
            const colors = [var(--primary), var(--accent), var(--success), var(--warning)];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = -10 + 'px';
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        // Show error message
        function showError(message) {
            errorText.textContent = message;
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Filter options
            filterOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const filterType = option.dataset.filter;
                    const filterValue = option.dataset.value;
                    
                    // Update active state
                    document.querySelectorAll(`.filter-option[data-filter="${filterType}"]`).forEach(opt => {
                        opt.classList.remove('active');
                    });
                    option.classList.add('active');
                    
                    // Update current filters
                    currentFilters[filterType] = filterValue;
                });
            });
            
            // Apply filters button
            applyFiltersBtn.addEventListener('click', loadFilteredCourses);
            
            // Course modal buttons
            closeCourseModal.addEventListener('click', () => courseModal.classList.remove('active'));
            cancelEnrollBtn.addEventListener('click', () => courseModal.classList.remove('active'));
            enrollBtn.addEventListener('click', () => {
                const courseId = enrollBtn.dataset.courseId;
                if (currentUser.enrolledCourses.length < 3) {
                    // Direct enrollment for 1st-3rd courses
                    completeEnrollment(courseId);
                } else {
                    // Show confirmation for 4th+ courses
                    confirmationModal.classList.add('active');
                    courseModal.classList.remove('active');
                }
            });
            
            // Confirmation modal buttons
            closeModalBtn.addEventListener('click', () => confirmationModal.classList.remove('active'));
            cancelBtn.addEventListener('click', () => confirmationModal.classList.remove('active'));
            confirmBtn.addEventListener('click', confirmEnrollment);
            
            // Tab buttons
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // Profile button
            profileBtn.addEventListener('click', () => {
                window.location.href = 'profile.html';
            });
            
            // Logout button
            logoutBtn.addEventListener('click', async () => {
                try {
                    await signOut(auth);
                    window.location.href = 'login.html';
                } catch (error) {
                    showError("Error signing out: " + error.message);
                }
            });

            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // Help FAB
            helpFab.addEventListener('click', () => helpModal.classList.add('active'));
            closeHelpModal.addEventListener('click', () => helpModal.classList.remove('active'));
            closeHelpBtn.addEventListener('click', () => helpModal.classList.remove('active'));
        }

        // Complete enrollment process
        async function completeEnrollment(courseId) {
            try {
                // Add to enrolled courses
                currentUser.enrolledCourses.push(courseId);
                
                // Initialize progress for this course
                currentUser.progress[courseId] = 0;
                
                // Save to Firebase
                await saveUserData();
                
                // Update UI
                loadFilteredCourses();
                loadEnrolledCourses();
                loadProgress();
                
                // Show success message with confetti
                showSuccess('Course enrolled successfully!', true);
                
                // Close modal
                courseModal.classList.remove('active');
            } catch (error) {
                showError("Error enrolling in course: " + error.message);
            }
        }

        // Switch between tabs
        function switchTab(tabId) {
            tabBtns.forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-tab') === tabId);
            });

            tabContents.forEach(content => {
                content.classList.toggle('active', content.id === `${tabId}-tab`);
            });
            
            // Load specific tab content if needed
            if (tabId === 'my-courses') {
                loadEnrolledCourses();
            } else if (tabId === 'progress') {
                loadProgress();
            }
        }

        // Toggle theme
        function toggleTheme() {
            const isDark = document.body.classList.contains('dark-theme');
            document.body.classList.remove(isDark ? 'dark-theme' : 'light-theme');
            document.body.classList.add(isDark ? 'light-theme' : 'dark-theme');
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
            themeToggle.innerHTML = isDark ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
        }

        // Check saved theme preference
        function checkTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.remove('light-theme');
                document.body.classList.add('dark-theme');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.body.classList.remove('dark-theme');
                document.body.classList.add('light-theme');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
